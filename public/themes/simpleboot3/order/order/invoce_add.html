
<div class="shopOrder-groupList">
	<div class="groupList-head">
		<h3>发票信息</h3>
	</div>
	<div class="groupList-list">
		<div class="orderinvo clear">
			<div class="orderdelive-div fl ordeliveCurrt">专用发票</div>
			<div class="orderdelive-div fl">普通发票（公司）</div>
			<div class="orderdelive-div fl">普通发票（个人）</div>
		</div>
		<div class="orderinvo-group">
			<!--专用发票-->
			<div class="orderinvo-group-list cateinvocurrent">
				<div class="excultxt">
					<ul class="excultxt-list">
						<foreach name="invoices[1]" item="vo">
							<li class="">
								<label class="excultxt-list-top">
									<input type="radio" name="invoice_id" class="invoice_id" value="">
									<span class="speTitle">{$vo.title}</span>
									<span class="speName">{$vo.name}</span>
									<input type="hidden" class="province" value="{$vo.accept_province}" />
									<input type="hidden" class="city" value="{$vo.accept_city}" />
									<input type="hidden" class="area" value="{$vo.accept_area}" />
									<input type="hidden" class="company_addr" value="{$vo.company_address}">
									<input type="hidden" class="company_phone" value="{$vo.company_tel}">
									<input type="hidden" class="company_num" value="{$vo.company_code}">
									<input type="hidden" class="company_bank" value="{$vo.bank}">
									<input type="hidden" class="company_banknum" value="{$vo.bank_num}">
									<input type="hidden" class="specifal_name" value="{$vo.accept_name}">
									<input type="hidden" class="specifal_tel" value="{$vo.accept_tel}">
									<input type="hidden" class="specifal_addr" value="{$vo.accept_address}">
									<input type="hidden" class="specifal_file" value="{$vo.file}">
								</label>
								<div class="excultxt-list-btn">
									<!-- <button type="button" class="exculdafult">默认</button> -->
									<!-- <button type="button" class="excultxtbtn">修改</button> -->
								</div>
							</li>
						</foreach>
						<li class="excultxtaddr">
							<label class="excultxt-list-top">
								<input type="radio" name="invoice_id" class="invoice_id" value="0" checked>
								<span>谢谢，我不用发票</span>
							</label>
						</li>
					</ul>
					<div class="exaddinvo">
						<button type="button" class="exAddInvoce">添加发票</button>
					</div>
				</div>
				<div class="exculform" style="display: none;">
					<div class="exclu-tip">
						<p>请确保所填开票信息与贵司税务登记证一致，避免不必要的损失。</p>
						<p>首次开局增值税专用发票或更改信息，需上传加盖公章的开票信息扫描件，客服代表接收到贵司开票信后，我司会在您的订单签</p>
						<p>满七天开具发票，发票建在每月的22号左右同意寄送，详见：<a href="memberCenter/invoice-xuzhi.html">《发票须知》</a></p>
					</div>
												
					<div class="shopexclu-form">
						<div class="groupInput-box clear">
							<p class="fl">发票抬头：</p>
							<div class="box-input fl">
								<input type="text" name="intitle" id="intitle" value="" class="orderbox-input" placeholder="请输入全名" />
							</div>
						</div>
						<!-- <div class="togginfo"><p>（<span>关闭</span>补全发票信息）<i class="iconfont icon-jiantou-copy"></i></p></div> -->
						<div class="groupbox-display">
							<div class="groupInput-box clear">
								<p class="fl">公司注册地址：</p>
								<div class="box-input fl">
									<input type="text" name="regaddr" id="regaddr" value="" class="orderbox-input" />
								</div>
							</div>
							<div class="groupInput-box clear">
								<p class="fl">公司电话：</p>
								<div class="box-input fl">
									<input type="text" name="comtel" id="comtel" value="" class="orderbox-input" placeholder="区号和号码用“-”隔开，或者不填区号" />
								</div>
							</div>
							<div class="groupInput-box clear">
								<p class="fl">税务登记号：</p>
								<div class="box-input fl">
									<input type="text" name="company_code" id="regnum" value="" class="orderbox-input" />
								</div>
							</div>
							<div class="groupInput-box clear">
								<p class="fl">开户银行：</p>
								<div class="box-input fl">
									<input type="text" name="kbank" id="kbank" value="" class="orderbox-input" />
								</div>
							</div>
							<div class="groupInput-box clear">
								<p class="fl">开户银行账号：</p>
								<div class="box-input fl">
									<input type="text" name="bankaccount" id="bankaccount" value="" class="orderbox-input" />
								</div>
							</div>
							<div class="groupInput-box clear">
								<p class="fl">收票人：</p>
								<div class="box-input fl">
									<input type="text" name="accept_name" id="sname" value="" class="orderbox-input" />
								</div>
							</div>
							<div class="groupInput-box clear">
								<p class="fl">收票人手机号：</p>
								<div class="box-input fl">
									<input type="text" name="accept_tel" id="sphone" value="" class="orderbox-input" />
								</div>
							</div>
							<div class="groupInput-box clear">
								<p class="fl">收票地址：</p>
								<div class="box-input fl">
									<select name="province" id="city11">
										<option value="0">省份</option>								
									</select>
									<select name="city" id="city22">
										<option value="0">地级市</option>								
									</select>
									<select name="area" id="city33">
										<option value="0">县/区</option>								
									</select>

								</div>
							</div>
							<div class="groupInput-box clear">
								<p class="fl">详细地址：</p>
								<div class="box-input fl">
									<textarea name="accept_address" id="addrdetail" class="shop-area"></textarea>
								</div>
							</div>
							<div class="groupInput-box invoformpad clear">
								<p class="fl">上传开票资料：</p>
								<div class="box-input fl">
									<label for="invo-file" class="invo-label">
										<p>请选择文件</p>
										<input type="file" name="invofile" id="invo_file" value="" class="invo-file hideinp" />
									</label>
								</div>
							</div>
						</div>
						<div class="groupInput-box clear">
							<p class="fl"></p>
							<div class="box-input fl">
								<input type="checkbox" name="tolecheck" id="tolecheck" value="" class="orcheck" checked/>
								<span>我已阅读并同意 <a href="memberCenter/invoice-xuzhi.html">《发票须知》</a></span>
							</div>
						</div>
															
						<div class="groupInput-box clear">
							<p class="fl"></p>
							<div class="box-input fl excuBtn">
								<button type="button" class="keepInvoce">保存</button>
								<button type="button" class="callOffInvoce">取消</button>
							</div>
						</div>
					</div>
												
				</div>
			</div>
			<!--普通发票公司-->
			<div class="orderinvo-group-list">
				<div class="invocateform-total">
					<ul class="invocateformTxt">
						<foreach name="invoices[2]" item="vo">
							<li class="">
								<label class="invocateform-top">
									<input type="radio" name="invoice_id" class="invoice_id" value="">
									<span>公司发票</span>
									<span class="companyTitle">{$vo.name}</span>
									<span class="acceptName">{$vo.accept_name}</span>
									<span class="acceptTel">{$vo.accept_tel}</span>
									<input type="hidden" class="province" value="{$vo.accept_province}" />
									<input type="hidden" class="city" value="{$vo.accept_city}" />
									<input type="hidden" class="area" value="{$vo.accept_area}" />
									<span class="acceptAddr"> {$vo.accept_address_info}<i>{$vo.accept_address}</i></span> 
									<!-- 给隐藏域赋值 -->
									<input type="hidden" class="" value="{$vo.accept_name}">
								</label>
								<!-- <div class="invocateform-button">
									<button type="button">默认</button>
									<button type="button" class="invoamendbtn">修改</button>
								</div> -->
							</li>
						</foreach>
					<li class="incocateaddr">
						<label class="invocateform-top">
							<input type="radio" name="invoice_id" class="invoice_id" value="0" >
							<span>我不开发票，谢谢！</span> 
						</label>
					</li>
					</ul>
					<!--添加-->
					<div class="invocateAdd">
						<button type="button" class="cate-addbtn">添加发票</button>
					</div>
					<!---->
				</div>
				<!--表格-->
				<div class="invocatedisplayform">
					<div class="invocate-box">
						<div class="orderinvo-company cateinvocurrent">
							<div class="invocateform">
																
								<div class="shopexclu-form">
									<div class="groupInput-box clear">
										<p class="fl">发票抬头：</p>
										<div class="box-input fl">
											<input type="text" name="intitle" id="comTitle" value="" class="orderbox-input" placeholder="请输入全名" />
										</div>
									</div>
									<div class="groupInput-box clear">
										<p class="fl">税务登记号：</p>
										<div class="box-input fl">
											<input type="text" name="regnum" id="comregnum" value="" class="orderbox-input" />
										</div>
									</div>
									<!-- <div class="togginfo"><p><span>展开</span>补全发票信息（非必填）<i class="iconfont icon-jiantou-copy"></i></p></div> -->
									
									<div class="groupInput-box clear">
										<p class="fl">收票人：</p>
										<div class="box-input fl">
											<input type="text" name="sname" id="comsname" value="" class="orderbox-input" />
										</div>
									</div>
									<div class="groupInput-box clear">
										<p class="fl">收票人手机号：</p>
										<div class="box-input fl">
											<input type="text" name="sphone" id="comatel" value="" class="orderbox-input" />
										</div>
									</div>
									<div class="groupInput-box clear">
										<p class="fl">收票地址：</p>
										<div class="box-input fl">
											<select name="province" id="city111">
												<option value="0">省份</option>
																					
											</select>
											<select name="city" id="city222">
												<option value="0">地级市</option>
																					
											</select>
											<select name="area" id="city333">
												<option value="0">县/区</option>
																					
											</select>

										</div>
									</div>
									<div class="groupInput-box clear">
										<p class="fl">详细地址：</p>
										<div class="box-input fl">
										<textarea name="addrdetail" id="comAddress" class="shop-area"></textarea>
										</div>
									</div>
									
									<div class="groupInput-box clear">
										<p class="fl"></p>
										<div class="box-input fl">
											<input type="checkbox" name="tolecheck" id="comcheck" value="" class="orcheck" checked/>
											<span>我已阅读并同意 <a href="memberCenter/invoice-xuzhi.html">《发票须知》</a></span>
										</div>
									</div>
									<p class="deml tipMsg"></p>
									<div class="groupInput-box clear">
										<p class="fl"></p>
										<div class="box-input fl personBtn">
											<button type="button" class="keepComInvoce">保存</button>
											<button type="button" class="callOffCom">取消</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 普通发票个人 -->
			<div class="orderinvo-group-list">
				<div class="invocateform-total">
						<ul class="invocateformTxt">				
							<foreach name="invoices[3]" item="vo">
								<li class="">
									<label class="invocateform-top">
										<input type="radio" name="invoice_id" class="invoice_id" value="">
										<span>个人发票 &nbsp;&nbsp;</span>
										<span class="perTitle">{$vo.name}</span>
										<span class="perName">{$vo.accept_name}</span>
										<span class="perTel">{$vo.accept_tel}</span>
										<span class="perAddr">{$vo.accept_address_info}<i>{$vo.accept_address}</i></span>  
										<input type="hidden" class="province" value="{$vo.accept_province}" />
										<input type="hidden" class="city" value="{$vo.accept_city}" />
										<input type="hidden" class="area" value="{$vo.accept_area}" />
									</label>
									<!-- <div class="invocateform-button">
										<button type="button">默认</button>
										<button type="button" class="invoamendbtn">修改</button>
									</div> -->
								</li>
							</foreach>					
							<li class='incocateaddr'>
								<label class="invocateform-top">
									<input type="radio" name="invoice_id" class="invoice_id" value="0" >
									<span>我不开发票，谢谢！</span>
								</label>
							</li>
						</ul>
						<!--添加-->
						<div class="personInvoAdd">
							<button type="button" class="person_addbtn">添加发票</button>
						</div>
					<!---->
				</div>
				<!--表格-->
				<div class="invoCatePersonForm">
					<div class="invocate-box">
						<!--  -->
						<div class="orderinvo-person cateinvocurrent">
							<div class="invopersonform">
												
								<div class="shopexclu-form">
									<div class="groupInput-box clear">
										<p class="fl">发票抬头：</p>
										<div class="box-input fl">
											<input type="text" name="intitle" id="intitle" value="" class="orderbox-input" placeholder="请输入全名" />
										</div>
									</div>
									<!-- <div class="togginfo">
										<p><span>展开</span>补全发票信息（非必填）<i class="iconfont icon-jiantou-copy"></i></p>
									</div> -->
								
									<div class="groupInput-box clear">
										<p class="fl">收票人：</p>
										<div class="box-input fl">
											<input type="text" name="sname" id="psname" value="" class="orderbox-input" />
										</div>
									</div>
									<div class="groupInput-box clear">
										<p class="fl">收票人手机号：</p>
										<div class="box-input fl">
											<input type="text" name="sphone" id="pstel" value="" class="orderbox-input" />
										</div>
									</div>
									<div class="groupInput-box clear">
										<p class="fl">选择城市：</p>
										<div class="box-input fl">
											<select name="province" id="city1111">
													<option value="0">省份</option>
																					
											</select>
											<select name="city" id="city2222">
												<option value="0">地级市</option>
																					
											</select>
											<select name="area" id="city3333">
												<option value="0">县/区</option>
																					
											</select>

										</div>
									</div>
									<div class="groupInput-box clear">
										<p class="fl">详细地址：</p>
										<div class="box-input fl">
											<textarea name="addrdetail" id="psaddr" class="shop-area"></textarea>
										</div>
									</div>
								
									<div class="groupInput-box clear">
										<p class="fl"></p>
										<div class="box-input fl">
											<input type="checkbox" name="tolecheck" id="pscheck" value="" class="orcheck" checked />
											<span>我已阅读并同意 <a href="memberCenter/invoice-xuzhi.html">《发票须知》</a></span>
										</div>
									</div>
									<p class="deml tipMsg"></p>
									<div class="groupInput-box clear">
										<p class="fl"></p>
										<div class="box-input fl personBtn">
											<button type="button" class="keepCatePerson">保存</button>
											<button type="button" class="callOffPerson">取消</button>
										</div>
									</div>
								</div>
												
							</div>
						</div>
					</div>
				</div>
			</div>


		<!--  -->
		</div>
	</div>
</div>
							
<script type="text/javascript">
	$(function () {
		city_js(0, 1, $('#city11'), 0, $('#city22'), 0, $('#city33'), 0);
		city_js(0, 1, $('#city111'), 0, $('#city222'), 0, $('#city333'), 0);
		city_js(0, 1, $('#city1111'), 0, $('#city2222'), 0, $('#city3333'), 0);

		var url_invoice_do = "{:url('invoice/invoice_user/invoice_infos_do')}";
		// 专用发票保存
		$(".keepInvoce").click(function () {
			var name = $.trim($("#intitle").val());
			var company_address = $.trim($("#regaddr").val());
			var province = $('#city11').val();
			var city = $('#city22').val();
			var area = $('#city33').val();
			var company_tel = $.trim($("#comtel").val());
			var company_code = $.trim($("#regnum").val());
			var bank = $.trim($("#kbank").val());
			var bank_num = $.trim($("#bankaccount").val());
			var accept_name = $.trim($("#sname").val());
			var accept_tel = $.trim($("#sphone").val());
			var accept_address = $.trim($("#addrdetail").val());
			var file = $("#invo_file").val();
			
			var data_json = {
				'type': type, 'name': name, 'province': province, 'city': city, 'area': area,
				'accept_name': accept_name, 'accept_tel': accept_tel, 'accept_address': accept_address,
				'company_address': company_address, 'company_tel': company_tel, 'company_code': company_code,
				'bank': bank, 'bank_num': bank_num, 'file': file
			};


			$.ajax({
				"url": url_invoice_do,
				"type": "POST",
				"data": data_json,
				"dataType": "json",
				"success": function (data) {
					if(data.code == 1){
						console.log(data);
						
						var invoceAdd = '<li class="excultxtaddr">'+
											'<label class="excultxt-list-top" >'+
												'<input type="radio" name="invoice_id" class="invoice_id" value="" checked>'+
												// '<span class="speTitle">'+  +'</span>'+
												'<span class="speName">'+ name +'</span>'+
												'<input type="hidden" class="province" value="'+ province +'" />'+
												'<input type="hidden" class="city" value="' + city +'" />' +
												'<input type="hidden" class="area" value="' + area +'" />' +
												'<input type="hidden" class="company_addr" value="' + company_address +'">'+
												'<input type="hidden" class="company_phone" value="' + company_tel +'">' +
												'<input type="hidden" class="company_num" value="' + company_code +'">'+
												'<input type="hidden" class="company_bank" value="' + bank +'">' +
												'<input type="hidden" class="company_banknum" value="' + bank_num +'">' +
												'<input type="hidden" class="specifal_name" value="' + accept_name +'">' +
												'<input type="hidden" class="specifal_tel" value="' + accept_tel +'">' +
												'<input type="hidden" class="specifal_addr" value="' + accept_address +'">' +
												'<input type="hidden" class="specifal_file" value="' + file +'">' +
											'</label>'+
											// '<div class="excultxt-list-btn">'+
											// 	'<button type="button" class="excultxtbtn">修改</button>'+
											// '</div>'+
										'</li >';
						$(".excultxt>ul>li").removeClass("excultxtaddr");
						msg(data.msg);
						$(".exculform").hide();
						$(document.body).toggleClass("html_overflow");
						$(".excultxt>ul").prepend(invoceAdd);

					}else {
						//失败
						msg(data.msg);
					}					
				},
				"error": function (event, XMLHttpRequest, ajaxOptions, thrownError) {
					msg(event.responseText, 1);
				}
			});

			return false;

		});

	// 专用发票修改
	$(".excultxtbtn").click(function () {
		$(".exculform").show();
		$(document.body).toggleClass("html_overflow");
		var $div = $(this).parents("li");
		var name = $div.find(".speName").text();
		console.log(name);
		var province = $div.find(".province").val();
		var city = $div.find(".city").val();
		var area = $div.find(".area").val();
		$('#city11').val(province);
		get_citys($('#city22'), province, city);
		get_citys($('#city33'), city, area);
		var company_address = $div.find(".company_addr").val();
		var company_tel = $div.find(".company_phone").val();
		var company_code = $div.find(".company_num").val();
		var bank = $div.find(".company_bank").val();
		var bank_num = $div.find(".company_banknum").val();
		var accept_name = $div.find(".specifal_name").val();
		var accept_tel = $div.find(".specifal_tel").val();
		var accept_address = $div.find(".specifal_addr").val();
		var file = $div.find(".specifal_file").val();
		$("#intitle").val(name);
		$("#regaddr").val(company_address);
		$("#comtel").val(company_tel);
		$("#regnum").val(company_code);
		$("#kbank").val(bank);
		$("#bankaccount").val(bank_num);
		$("#sname").val(accept_name);
		$("#sphone").val(accept_tel);
		$("#addrdetail").val(accept_address);
		$("#invo_file").val(file);

	});
	// 新增发票
	$(".exAddInvoce").click(function () {
		$(".exculform").show();
		$(document.body).toggleClass("html_overflow");
		city_js(0, 1, $('#city11'), 0, $('#city22'), 0, $('#city33'), 0);
		$("#intitle").val("");
		$("#regaddr").val("");
		$("#comtel").val("");
		$("#regnum").val("");
		$("#kbank").val("");
		$("#bankaccount").val("");
		$("#sname").val("");
		$("#sphone").val("");
		$("#addrdetail").val("");
		$("#invo_file").val("");



	});


	// 普通公司发票保存

	$(".keepComInvoce").click(function () {
		var name = $.trim($("#comTitle").val());
		var company_address = $.trim($("#regaddr").val());
		var province = $('#city111').val();
		var city = $('#city222').val();
		var area = $('#city333').val();
		var company_tel = $.trim($("#comtel").val());
		var company_code = $.trim($("#comregnum").val());
		var bank = $.trim($("#kbank").val());
		var bank_num = $.trim($("#bankaccount").val());
		var accept_name = $.trim($("#sname").val());
		var accept_tel = $.trim($("#sphone").val());
		var accept_address = $.trim($("#addrdetail").val());
		var file = $("#invo_file").val();














		var data_json = {
			'type': type, 'name': name, 'province': province, 'city': city, 'area': area,
			'accept_name': accept_name, 'accept_tel': accept_tel, 'accept_address': accept_address,
			'company_address': company_address, 'company_tel': company_tel, 'company_code': company_code,
			'bank': bank, 'bank_num': bank_num, 'file': file
		};


		$.ajax({
			"url": url_invoice_do,
			"type": "POST",
			"data": data_json,
			"dataType": "json",
			"success": function (data) {
				if (data.code == 1) {
					console.log(data);

					var invoceAdd = '<li class="excultxtaddr">' +
										'<label class="excultxt-list-top" >' +
											'<span class="speName">' + name + '</span>' +
											'<span class="speName">' + name + '</span>' +
											'<span class="speName">' + name + '</span>' +
										'</label >' +
										// '<div class="excultxt-list-btn">' +
										// '<button type="button" class="excultxtbtn">修改</button>' +
										// '</div>' +
									'</li >';
					$(".excultxt>ul>li").removeClass("excultxtaddr");
					msg(data.msg);
					$(".exculform").hide();
					$(document.body).toggleClass("html_overflow");
					$(".excultxt>ul").prepend(invoceAdd);

				} else {
					//失败
					msg(data.msg);
				}
			},
			"error": function (event, XMLHttpRequest, ajaxOptions, thrownError) {
				msg(event.responseText, 1);
			}
		});

		return false;










	});










		








	});
								
								
								
</script>